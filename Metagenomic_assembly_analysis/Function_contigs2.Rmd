---
title: "Function contigs year 2"
author: "Liz Mallott"
date: "4/1/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Setting up environment

```{r libraries}
library(tidyverse)
library(vegan)
library(fdrtool)
```
## COGs

### Import
COGnames with functional categories are imported. Relative abundances of each COG for individual samples are imported and vertically appended. We then reshape the dataframe. COGnames file and relative abundance file are joined to append COG categories

```{r import_cogs, echo = F}
cognames = read_tsv("COG_files/cognames2003-2014.txt") %>% 
  select(-name) %>% 
  distinct()
ra_cog_files = list.files(path = "COG_files", pattern = "run", full.names = T)
rel_abund_cog_long = ra_cog_files %>% 
  set_names() %>% 
  map_dfr(read_tsv, .id = "source") %>% 
  mutate(source2 = stringr::str_replace(source, "COG_files/", "")) %>% 
  mutate(sample = sub('\\.txt$', '', source2))
rel_abund_cog_long_names = rel_abund_cog_long %>% 
  left_join(cognames) %>% 
  dplyr::select(-taxid, -source, -source2)
rel_abund_cog = rel_abund_cog_long_names %>% 
  group_by(func, sample) %>% 
  summarize(relative_abundance = sum(abundance)) %>% 
  pivot_wider(names_from = "sample", values_from = "relative_abundance")
write_tsv(rel_abund_cog, "tables/rel_abund_cog_y2.txt")
```

Metadata is imported.
```{r import_metadata, echo = F}
metadata = read_tsv("year2_sample_mapping.txt")
metadata2 = metadata %>% 
  mutate(Ethnicity = case_when(Ethnicity == "African_American" ~ "Black", 
                               Ethnicity == "Caucasian" ~ "White"))
```

### Chi-square test of antibiotic/contraceptive use

We used chi-square tests to examine if antibiotic use or contraceptive use were associated with ethnicity.
```{r chis}
metadata_anti = read_tsv("year2_contingency.txt") %>% 
  column_to_rownames(var = "X1") %>% 
  dplyr::select(1:2)

metadata_contra = read_tsv("year2_contingency.txt") %>% 
  column_to_rownames(var = "X1") %>% 
  dplyr::select(3:4)

anti = chisq.test(metadata_anti)
anti

contra = chisq.test(metadata_contra)
contra
```

### Filter data

The relative abundance table is transposed and file names are cleaned up. It is then joined with the metadata for PERMANOVA analyses. Individual tables for fecal and oral samples for each study period and for each ethnicity are created.
```{r ra_perm}
rel_abund_cog = read_tsv("tables/rel_abund_cog_y2_collapsed_categories.txt")
rel_abund_cog_t = rel_abund_cog %>% 
  pivot_longer(cols = 2:163, names_to = "file_prefix", 
               values_to = "abundance") %>% 
  pivot_wider(names_from = "func", values_from = "abundance") %>% 
  mutate_at("file_prefix", str_replace, "-", "_") %>% 
  left_join(metadata2)
relab_cog_fecal = rel_abund_cog_t %>% 
  filter(fecal_use == 1) 
relab_cog_fecal_filtered = relab_cog_fecal %>% 
  mutate_if(is.numeric, ~ (ifelse(is.na(.), 0, .)))
relab_cog_fecal_filtered_black = relab_cog_fecal_filtered %>% 
  filter(Ethnicity == "Black")
relab_cog_fecal_filtered_white = relab_cog_fecal_filtered %>% 
  filter(Ethnicity == "White")
relab_cog_fecal_filtered_before = relab_cog_fecal_filtered %>% 
  filter(`Study period` == "Before")
relab_cog_fecal_filtered_during = relab_cog_fecal_filtered %>% 
  filter(`Study period` == "During")
relab_cog_fecal_filtered_after = relab_cog_fecal_filtered %>% 
  filter(`Study period` == "After")

relab_cog_oral= rel_abund_cog_t %>% 
  filter(oral_use == 1)
relab_cog_oral_filtered = relab_cog_oral %>% 
  mutate_if(is.numeric, ~ (ifelse(is.na(.), 0, .)))
relab_cog_oral_filtered_black = relab_cog_oral_filtered %>% 
  filter(Ethnicity == "Black")
relab_cog_oral_filtered_white = relab_cog_oral_filtered %>% 
  filter(Ethnicity == "White")
relab_cog_oral_filtered_before = relab_cog_oral_filtered %>% 
  filter(`Study period` == "Before")
relab_cog_oral_filtered_after = relab_cog_oral_filtered %>% 
  filter(`Study period` == "After")
```

### PERMANOVAs

Bray-Curtis and Jaccard distance matrices are created using vegan (v2.5-7). Matrices are constructed for all oral samples, all fecal samples, and oral and fecal samples broken down by ethnicity and study stage.

```{r beta_metrics, error=FALSE}
bray_cog_fecal = vegdist(relab_cog_fecal_filtered[,2:25], method = "bray")
jacc_cog_fecal = vegdist(relab_cog_fecal_filtered[,2:25], method = "jaccard")
bray_cog_fecal_black = vegdist(relab_cog_fecal_filtered_black[,2:25], 
                           method = "bray")
bray_cog_fecal_white = vegdist(relab_cog_fecal_filtered_white[,2:25], 
                           method = "bray")
jacc_cog_fecal_black = vegdist(relab_cog_fecal_filtered_black[,2:25], 
                           method = "jaccard")
jacc_cog_fecal_white = vegdist(relab_cog_fecal_filtered_white[,2:25], 
                           method = "jaccard")
bray_cog_fecal_before = vegdist(relab_cog_fecal_filtered_before[,2:25], 
                           method = "jaccard")
bray_cog_fecal_during = vegdist(relab_cog_fecal_filtered_during[,2:25], 
                           method = "jaccard")
bray_cog_fecal_after = vegdist(relab_cog_fecal_filtered_after[,2:25], 
                           method = "jaccard")
jacc_cog_fecal_before = vegdist(relab_cog_fecal_filtered_before[,2:25], 
                           method = "jaccard")
jacc_cog_fecal_during = vegdist(relab_cog_fecal_filtered_during[,2:25], 
                           method = "jaccard")
jacc_cog_fecal_after = vegdist(relab_cog_fecal_filtered_after[,2:25], 
                           method = "jaccard") 

bray_cog_oral = vegdist(relab_cog_oral_filtered[,2:25], method = "bray")
jacc_cog_oral = vegdist(relab_cog_oral_filtered[,2:25], method = "jaccard")
bray_cog_oral_black = vegdist(relab_cog_oral_filtered_black[,2:25], method = "bray")
bray_cog_oral_white = vegdist(relab_cog_oral_filtered_white[,2:25], method = "bray")
jacc_cog_oral_black = vegdist(relab_cog_oral_filtered_black[,2:25], method = "jaccard")
jacc_cog_oral_white = vegdist(relab_cog_oral_filtered_white[,2:25], method = "jaccard")
bray_cog_oral_before = vegdist(relab_cog_oral_filtered_before[,2:25], 
                           method = "jaccard")
bray_cog_oral_after = vegdist(relab_cog_oral_filtered_after[,2:25], 
                          method = "jaccard")
jacc_cog_oral_before = vegdist(relab_cog_oral_filtered_before[,2:25], 
                           method = "jaccard")
jacc_cog_oral_after = vegdist(relab_cog_oral_filtered_after[,2:25], 
                          method = "jaccard")
```

Differences in the COG profile of the community associated with self-reported ethnicity, subject id, and study stage is assessed using permutational multivariate analysis of variance.

#### Bray-Curtis
cog_fecal
```{r permanova_brayf}
adonis2(bray_cog_fecal ~ subject_id + `Study period` + subject_id*`Study period`, 
        data = relab_cog_fecal_filtered, 
        permutations = 4999)
adonis2(bray_cog_fecal ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use`, data = relab_cog_fecal_filtered, permutations = 4999)

adonis2(bray_cog_fecal ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_cog_fecal_filtered, permutations = 4999)

adonis2(bray_cog_fecal ~ Ethnicity, 
        data = relab_cog_fecal_filtered, 
        permutations = 4999)
adonis2(bray_cog_fecal_before ~ Ethnicity, 
        data = relab_cog_fecal_filtered_before, 
        permutations = 4999)
adonis2(bray_cog_fecal_during ~ Ethnicity, 
        data = relab_cog_fecal_filtered_during, 
        permutations = 4999)
adonis2(bray_cog_fecal_after ~ Ethnicity, 
        data = relab_cog_fecal_filtered_after, 
        permutations = 4999)

adonis2(bray_cog_fecal ~ `Study period`, 
        data = relab_cog_fecal_filtered, 
        permutations = 4999)
adonis2(bray_cog_fecal_black ~ `Study period`, 
        data = relab_cog_fecal_filtered_black, 
        permutations = 4999)
adonis2(bray_cog_fecal_white ~ `Study period`, 
        data = relab_cog_fecal_filtered_white, 
        permutations = 4999)
```

cog_oral
```{r permanova_brayo}
adonis2(bray_cog_oral ~ subject_id + `Study period`, 
        data = relab_cog_oral_filtered, 
        permutations = 4999)
adonis2(bray_cog_oral ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use`, data = relab_cog_oral_filtered, permutations = 4999)

adonis2(bray_cog_oral ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_cog_oral_filtered, permutations = 4999)

adonis2(bray_cog_oral ~ Ethnicity, 
        data = relab_cog_oral_filtered, 
        permutations = 4999)
adonis2(bray_cog_oral_before ~ Ethnicity, 
        data = relab_cog_oral_filtered_before, 
        permutations = 4999)
adonis2(bray_cog_oral_after ~ Ethnicity, 
        data = relab_cog_oral_filtered_after, 
        permutations = 4999)

adonis2(bray_cog_oral ~ `Study period`, 
        data = relab_cog_oral_filtered, 
        permutations = 4999)
adonis2(bray_cog_oral_black ~ `Study period`, 
        data = relab_cog_oral_filtered_black, 
        permutations = 4999)
adonis2(bray_cog_oral_white ~ `Study period`, 
        data = relab_cog_oral_filtered_white, 
        permutations = 4999)

```

#### Jaccard
cog_fecal
```{r permanova_jaccf}
adonis2(jacc_cog_fecal ~ subject_id + `Study period` + subject_id*`Study period`, 
        data = relab_cog_fecal_filtered, 
        permutations = 4999)
adonis2(jacc_cog_fecal ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use`, data = relab_cog_fecal_filtered, permutations = 4999)

adonis2(jacc_cog_fecal ~ Ethnicity, 
        data = relab_cog_fecal_filtered, 
        permutations = 4999)
adonis2(jacc_cog_fecal_before ~ Ethnicity, 
        data = relab_cog_fecal_filtered_before, 
        permutations = 4999)
adonis2(jacc_cog_fecal_during ~ Ethnicity, 
        data = relab_cog_fecal_filtered_during, 
        permutations = 4999)
adonis2(jacc_cog_fecal_after ~ Ethnicity, 
        data = relab_cog_fecal_filtered_after, 
        permutations = 4999)

adonis2(jacc_cog_fecal ~ `Study period`, 
        data = relab_cog_fecal_filtered, 
        permutations = 4999)
adonis2(jacc_cog_fecal_black ~ `Study period`, 
        data = relab_cog_fecal_filtered_black, 
        permutations = 4999)
adonis2(jacc_cog_fecal_white ~ `Study period`, 
        data = relab_cog_fecal_filtered_white, 
        permutations = 4999)
```

cog_oral
```{r permanova_jacco}
adonis2(jacc_cog_oral ~ subject_id + `Study period`, 
        data = relab_cog_oral_filtered, 
        permutations = 4999)
adonis2(bray_cog_oral ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use`, data = relab_cog_oral_filtered, permutations = 4999)

adonis2(jacc_cog_oral ~ Ethnicity, 
        data = relab_cog_oral_filtered, 
        permutations = 4999)
adonis2(jacc_cog_oral_before ~ Ethnicity, 
        data = relab_cog_oral_filtered_before, 
        permutations = 4999)
adonis2(jacc_cog_oral_after ~ Ethnicity, 
        data = relab_cog_oral_filtered_after, 
        permutations = 4999)

adonis2(jacc_cog_oral ~ `Study period`, 
        data = relab_cog_oral_filtered, 
        permutations = 4999)
adonis2(jacc_cog_oral_black ~ `Study period`, 
        data = relab_cog_oral_filtered_black, 
        permutations = 4999)
adonis2(jacc_cog_oral_white ~ `Study period`, 
        data = relab_cog_oral_filtered_white, 
        permutations = 4999)
```

### COG abundance

Wilcoxon Rank Sum tests (base R) were used to assess if self-reported Ethnicity is associated with the abundance of individual COG categories. P-values are corrected using fdrtool (v.1.2.16).

```{r cog_models_fecal}
Ethnicity_estimatematrix = mat.or.vec(24,2)
Ethnicity_pvaluematrix = mat.or.vec(24,2)

relab_cog_fecal_filtered = as.data.frame(relab_cog_fecal_filtered)

relab_cog_ethnicity = relab_cog_fecal_filtered %>% 
  group_by(Ethnicity) %>% 
  summarize(across(A:X, ~mean(.)))
relab_cog_ethnicity_t = as.data.frame(t(relab_cog_ethnicity))
names(relab_cog_ethnicity_t) <- relab_cog_ethnicity_t[1,]
relab_cog_ethnicity_t = relab_cog_ethnicity_t[-1,]

for(i in 2:25) {
  variable = relab_cog_fecal_filtered[,i]
  b = wilcox.test(variable ~ Ethnicity, 
                  data = relab_cog_fecal_filtered,
                  paired = F, exact = F)
  Ethnicity_estimatematrix[i-1,2] = b$statistic
  Ethnicity_pvaluematrix[i-1,2] = b$p.value
  Ethnicity_estimatematrix[i-1,1] = names(relab_cog_fecal_filtered)[i]
  Ethnicity_pvaluematrix[i-1,1] = names(relab_cog_fecal_filtered)[i]
}


cog_Ethnicity = bind_cols(as.data.frame(Ethnicity_estimatematrix[,1:2]), 
                     as.data.frame(Ethnicity_pvaluematrix[,2]), 
                     as.data.frame(relab_cog_ethnicity_t[,1:2]))
write.csv(cog_Ethnicity, "tables/cog_fecal_wilcox_Ethnicity_y2.csv")
cog_Ethnicity_nona = filter(cog_Ethnicity, cog_Ethnicity[,3] != "NaN") 
cog_Ethnicity_nona[,3] = as.numeric(as.character(cog_Ethnicity_nona[,3]))
cog_Ethnicity_corrected = bind_cols(cog_Ethnicity_nona, 
                               as.data.frame(fdrtool(cog_Ethnicity_nona[,3], 
                                                     statistic = "pvalue", 
                                                     plot = F)))
write.csv(cog_Ethnicity_corrected, "tables/cog_fecal_wilcox_Ethnicity_corrected_y2.csv")
```

```{r cog_models_fecal_before}
Ethnicity_estimatematrix = mat.or.vec(24,2)
Ethnicity_pvaluematrix = mat.or.vec(24,2)

relab_cog_fecal_filtered_before = as.data.frame(relab_cog_fecal_filtered_before)

relab_cog_ethnicity_before = relab_cog_fecal_filtered_before %>% 
  group_by(Ethnicity) %>% 
  summarize(across(A:X, ~mean(.)))
relab_cog_ethnicity_before_t = as.data.frame(t(relab_cog_ethnicity_before))
names(relab_cog_ethnicity_before_t) <- relab_cog_ethnicity_before_t[1,]
relab_cog_ethnicity_before_t = relab_cog_ethnicity_before_t[-1,]

for(i in 2:25) {
  variable = relab_cog_fecal_filtered_before[,i]
  b = wilcox.test(variable ~ Ethnicity, 
                  data = relab_cog_fecal_filtered_before,
                  paired = F, exact = F)
  Ethnicity_estimatematrix[i-1,2] = b$statistic
  Ethnicity_pvaluematrix[i-1,2] = b$p.value
  Ethnicity_estimatematrix[i-1,1] = names(relab_cog_fecal_filtered_before)[i]
  Ethnicity_pvaluematrix[i-1,1] = names(relab_cog_fecal_filtered_before)[i]
}


cog_Ethnicity_before = bind_cols(as.data.frame(Ethnicity_estimatematrix[,1:2]), 
                     as.data.frame(Ethnicity_pvaluematrix[,2]), 
                     as.data.frame(relab_cog_ethnicity_before_t[,1:2]))
write.csv(cog_Ethnicity_before, "tables/cog_fecal_wilcox_Ethnicity_before_y2.csv")
cog_Ethnicity_before_nona = filter(cog_Ethnicity_before, cog_Ethnicity_before[,3] != "NaN") 
cog_Ethnicity_before_nona[,3] = as.numeric(as.character(cog_Ethnicity_before_nona[,3]))
cog_Ethnicity_corrected_before = bind_cols(cog_Ethnicity_before_nona, 
                               as.data.frame(fdrtool(cog_Ethnicity_before_nona[,3], 
                                                     statistic = "pvalue", 
                                                     plot = F)))
write.csv(cog_Ethnicity_corrected_before, "tables/cog_fecal_wilcox_Ethnicity_before_corrected_y2.csv")
```

```{r cog_models_fecal_during}
Ethnicity_estimatematrix = mat.or.vec(24,2)
Ethnicity_pvaluematrix = mat.or.vec(24,2)

relab_cog_fecal_filtered_during = as.data.frame(relab_cog_fecal_filtered_during)

relab_cog_ethnicity_during = relab_cog_fecal_filtered_during %>% 
  group_by(Ethnicity) %>% 
  summarize(across(A:X, ~mean(.)))
relab_cog_ethnicity_during_t = as.data.frame(t(relab_cog_ethnicity_during))
names(relab_cog_ethnicity_during_t) <- relab_cog_ethnicity_during_t[1,]
relab_cog_ethnicity_during_t = relab_cog_ethnicity_during_t[-1,]

for(i in 2:25) {
  variable = relab_cog_fecal_filtered_during[,i]
  b = wilcox.test(variable ~ Ethnicity, 
                  data = relab_cog_fecal_filtered_during,
                  paired = F, exact = F)
  Ethnicity_estimatematrix[i-1,2] = b$statistic
  Ethnicity_pvaluematrix[i-1,2] = b$p.value
  Ethnicity_estimatematrix[i-1,1] = names(relab_cog_fecal_filtered_during)[i]
  Ethnicity_pvaluematrix[i-1,1] = names(relab_cog_fecal_filtered_during)[i]
}


cog_Ethnicity_during = bind_cols(as.data.frame(Ethnicity_estimatematrix[,1:2]), 
                     as.data.frame(Ethnicity_pvaluematrix[,2]), 
                     as.data.frame(relab_cog_ethnicity_during_t[,1:2]))
write.csv(cog_Ethnicity_during, "tables/cog_fecal_wilcox_Ethnicity_during_y2.csv")
cog_Ethnicity_during_nona = filter(cog_Ethnicity_during, cog_Ethnicity_during[,3] != "NaN") 
cog_Ethnicity_during_nona[,3] = as.numeric(as.character(cog_Ethnicity_during_nona[,3]))
cog_Ethnicity_corrected_during = bind_cols(cog_Ethnicity_during_nona, 
                               as.data.frame(fdrtool(cog_Ethnicity_during_nona[,3], 
                                                     statistic = "pvalue", 
                                                     plot = F)))
write.csv(cog_Ethnicity_corrected_during, "tables/cog_fecal_wilcox_Ethnicity_during_corrected_y2.csv")
```

```{r cog_models_fecal_after}
Ethnicity_estimatematrix = mat.or.vec(24,2)
Ethnicity_pvaluematrix = mat.or.vec(24,2)

relab_cog_fecal_filtered_after = as.data.frame(relab_cog_fecal_filtered_after)

relab_cog_ethnicity_after = relab_cog_fecal_filtered_after %>% 
  group_by(Ethnicity) %>% 
  summarize(across(A:X, ~mean(.)))
relab_cog_ethnicity_after_t = as.data.frame(t(relab_cog_ethnicity_after))
names(relab_cog_ethnicity_after_t) <- relab_cog_ethnicity_after_t[1,]
relab_cog_ethnicity_after_t = relab_cog_ethnicity_after_t[-1,]

for(i in 2:25) {
  variable = relab_cog_fecal_filtered_after[,i]
  b = wilcox.test(variable ~ Ethnicity, 
                  data = relab_cog_fecal_filtered_after,
                  paired = F, exact = F)
  Ethnicity_estimatematrix[i-1,2] = b$statistic
  Ethnicity_pvaluematrix[i-1,2] = b$p.value
  Ethnicity_estimatematrix[i-1,1] = names(relab_cog_fecal_filtered_after)[i]
  Ethnicity_pvaluematrix[i-1,1] = names(relab_cog_fecal_filtered_after)[i]
}


cog_Ethnicity_after = bind_cols(as.data.frame(Ethnicity_estimatematrix[,1:2]), 
                     as.data.frame(Ethnicity_pvaluematrix[,2]), 
                     as.data.frame(relab_cog_ethnicity_after_t[,1:2]))
write.csv(cog_Ethnicity_after, "tables/cog_fecal_wilcox_Ethnicity_after_y2.csv")
cog_Ethnicity_after_nona = filter(cog_Ethnicity_after, cog_Ethnicity_after[,3] != "NaN") 
cog_Ethnicity_after_nona[,3] = as.numeric(as.character(cog_Ethnicity_after_nona[,3]))
cog_Ethnicity_corrected_after = bind_cols(cog_Ethnicity_after_nona, 
                               as.data.frame(fdrtool(cog_Ethnicity_after_nona[,3], 
                                                     statistic = "pvalue", 
                                                     plot = F)))
write.csv(cog_Ethnicity_corrected_after, "tables/cog_fecal_wilcox_Ethnicity_after_corrected_y2.csv")
```

```{r cog_models_oral}
Ethnicity_estimatematrix = mat.or.vec(24,2)
Ethnicity_pvaluematrix = mat.or.vec(24,2)

relab_cog_oral_filtered = as.data.frame(relab_cog_oral_filtered)

relab_cog_ethnicity = relab_cog_oral_filtered %>% 
  group_by(Ethnicity) %>% 
  summarize(across(A:X, ~mean(.)))
relab_cog_ethnicity_t = as.data.frame(t(relab_cog_ethnicity))
names(relab_cog_ethnicity_t) <- relab_cog_ethnicity_t[1,]
relab_cog_ethnicity_t = relab_cog_ethnicity_t[-1,]

for(i in 2:25) {
  variable = relab_cog_oral_filtered[,i]
  b = wilcox.test(variable ~ Ethnicity, 
                  data = relab_cog_oral_filtered,
                  paired = F, exact = F)
  Ethnicity_estimatematrix[i-1,2] = b$statistic
  Ethnicity_pvaluematrix[i-1,2] = b$p.value
  Ethnicity_estimatematrix[i-1,1] = names(relab_cog_oral_filtered)[i]
  Ethnicity_pvaluematrix[i-1,1] = names(relab_cog_oral_filtered)[i]
}


cog_Ethnicity = bind_cols(as.data.frame(Ethnicity_estimatematrix[,1:2]), 
                     as.data.frame(Ethnicity_pvaluematrix[,2]), 
                     as.data.frame(relab_cog_ethnicity_t[,1:2]))
write.csv(cog_Ethnicity, "tables/cog_oral_wilcox_Ethnicity_y2.csv")
cog_Ethnicity_nona = filter(cog_Ethnicity, cog_Ethnicity[,3] != "NaN") 
cog_Ethnicity_nona[,3] = as.numeric(as.character(cog_Ethnicity_nona[,3]))
cog_Ethnicity_corrected = bind_cols(cog_Ethnicity_nona, 
                               as.data.frame(fdrtool(cog_Ethnicity_nona[,3], 
                                                     statistic = "pvalue", 
                                                     plot = F)))
write.csv(cog_Ethnicity_corrected, "tables/cog_oral_wilcox_Ethnicity_corrected_y2.csv")
```


## ARGs

### Import
Import individual relative abundance files. Collect and clean strings. Summarize based on ARG functional categories.
````{r import_args}
data_dir <- here("/Users/goblinking/Projects/ko_args/args/arg_ra")
class <- read_tsv("/Users/goblinking/Projects/ko_args/args/other/arg.category.txt") %>% 
    rename(.,RF= ResfamID)
data_list <- fs::dir_ls(data_dir, regexp = ".txt$")
data <-  data_list %>% 
  map_dfr(read_tsv, .id = "source") %>% 
  mutate(source2 = stringr::str_replace(source, "/Users/goblinking/Projects/ko_args/args/arg_ra/", "")) %>% 
  mutate(sample = sub('\\.txt$', '', source2)) %>% 
  left_join(.,class, by="RF") %>% 
  select(-source,-source2, -RF, -taxid)
  
data_abund <- data %>% rename(mechanism =`Mechanism Classification`) %>% 
  group_by(mechanism,sample) %>% 
  summarize(total = sum(abundance)) %>% 
  spread(mechanism,total) %>% 
  write_tsv("wide_arg_c2_contig.tsv")

rel_abund_arg = read_tsv("ARG_files/args_c2_contig.txt")
```

Metadata is imported.
```{r import_metadata, echo = F}
metadata = read_tsv("year2_sample_mapping.txt")
metadata2 = metadata %>% 
  mutate(Ethnicity = case_when(Ethnicity == "African_American" ~ "Black", 
                               Ethnicity == "Caucasian" ~ "White"))
```

### Filter data

The relative abundance table is transposed and file names are cleaned up. It is then joined with the metadata for PERMANOVA analyses. Individual tables for fecal and oral samples for each study period and for each ethnicity are created.
```{r ra_perm}
rel_abund_arg_meta = rel_abund_arg %>% 
  left_join(metadata2, by = c("Sample" = "SampleID"))

relab_arg_fecal = rel_abund_arg_meta %>% 
  filter(fecal_use == 1) 
relab_arg_fecal_filtered = relab_arg_fecal %>% 
  mutate_if(is.numeric, ~ (ifelse(is.na(.), 0, .)))
relab_arg_fecal_filtered_black = relab_arg_fecal_filtered %>% 
  filter(Ethnicity == "Black")
relab_arg_fecal_filtered_white = relab_arg_fecal_filtered %>% 
  filter(Ethnicity == "White")
relab_arg_fecal_filtered_before = relab_arg_fecal_filtered %>% 
  filter(`Study period` == "Before")
relab_arg_fecal_filtered_during = relab_arg_fecal_filtered %>% 
  filter(`Study period` == "During")
relab_arg_fecal_filtered_after = relab_arg_fecal_filtered %>% 
  filter(`Study period` == "After")

relab_arg_oral= rel_abund_arg_meta %>% 
  filter(oral_use == 1)
relab_arg_oral_filtered = relab_arg_oral %>% 
  mutate_if(is.numeric, ~ (ifelse(is.na(.), 0, .)))
relab_arg_oral_filtered_black = relab_arg_oral_filtered %>% 
  filter(Ethnicity == "Black")
relab_arg_oral_filtered_white = relab_arg_oral_filtered %>% 
  filter(Ethnicity == "White")
relab_arg_oral_filtered_before = relab_arg_oral_filtered %>% 
  filter(`Study period` == "Before")
relab_arg_oral_filtered_after = relab_arg_oral_filtered %>% 
  filter(`Study period` == "After")
```

### PERMANOVAs

Bray-Curtis and Jaccard distance matrices are created using vegan (v2.5-7). Matrices are constructed for all oral samples, all fecal samples, and oral and fecal samples broken down by ethnicity and study stage.

```{r beta_metrics, error=FALSE}
bray_arg_fecal = vegdist(relab_arg_fecal_filtered[,2:22], method = "bray")
jacc_arg_fecal = vegdist(relab_arg_fecal_filtered[,2:22], method = "jaccard")
bray_arg_fecal_black = vegdist(relab_arg_fecal_filtered_black[,2:22], 
                           method = "bray")
bray_arg_fecal_white = vegdist(relab_arg_fecal_filtered_white[,2:22], 
                           method = "bray")
jacc_arg_fecal_black = vegdist(relab_arg_fecal_filtered_black[,2:22], 
                           method = "jaccard")
jacc_arg_fecal_white = vegdist(relab_arg_fecal_filtered_white[,2:22], 
                           method = "jaccard")
bray_arg_fecal_before = vegdist(relab_arg_fecal_filtered_before[,2:22], 
                           method = "jaccard")
bray_arg_fecal_during = vegdist(relab_arg_fecal_filtered_during[,2:22], 
                           method = "jaccard")
bray_arg_fecal_after = vegdist(relab_arg_fecal_filtered_after[,2:22], 
                           method = "jaccard")
jacc_arg_fecal_before = vegdist(relab_arg_fecal_filtered_before[,2:22], 
                           method = "jaccard")
jacc_arg_fecal_during = vegdist(relab_arg_fecal_filtered_during[,2:22], 
                           method = "jaccard")
jacc_arg_fecal_after = vegdist(relab_arg_fecal_filtered_after[,2:22], 
                           method = "jaccard") 

bray_arg_oral = vegdist(relab_arg_oral_filtered[,2:22], method = "bray")
jacc_arg_oral = vegdist(relab_arg_oral_filtered[,2:22], method = "jaccard")
bray_arg_oral_black = vegdist(relab_arg_oral_filtered_black[,2:22], method = "bray")
bray_arg_oral_white = vegdist(relab_arg_oral_filtered_white[,2:22], method = "bray")
jacc_arg_oral_black = vegdist(relab_arg_oral_filtered_black[,2:22], method = "jaccard")
jacc_arg_oral_white = vegdist(relab_arg_oral_filtered_white[,2:22], method = "jaccard")
bray_arg_oral_before = vegdist(relab_arg_oral_filtered_before[,2:22], 
                           method = "jaccard")
bray_arg_oral_after = vegdist(relab_arg_oral_filtered_after[,2:22], 
                          method = "jaccard")
jacc_arg_oral_before = vegdist(relab_arg_oral_filtered_before[,2:22], 
                           method = "jaccard")
jacc_arg_oral_after = vegdist(relab_arg_oral_filtered_after[,2:22], 
                          method = "jaccard")
```

Differences in the ARG profile of the community associated with self-reported ethnicity, subject id, and study stage is assessed using permutational multivariate analysis of variance.

#### Bray-Curtis
arg_fecal
```{r permanova_brayf}
adonis2(bray_arg_fecal ~ subject_id + `Study period` + subject_id*`Study period`, 
        data = relab_arg_fecal_filtered, 
        permutations = 4999)
adonis2(bray_arg_fecal ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use`, data = relab_arg_fecal_filtered, permutations = 4999)
adonis2(bray_arg_fecal ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_arg_fecal_filtered, permutations = 4999)

adonis2(bray_arg_fecal ~ Ethnicity, 
        data = relab_arg_fecal_filtered, 
        permutations = 4999)
adonis2(bray_arg_fecal_before ~ Ethnicity, 
        data = relab_arg_fecal_filtered_before, 
        permutations = 4999)
adonis2(bray_arg_fecal_during ~ Ethnicity, 
        data = relab_arg_fecal_filtered_during, 
        permutations = 4999)
adonis2(bray_arg_fecal_after ~ Ethnicity, 
        data = relab_arg_fecal_filtered_after, 
        permutations = 4999)

adonis2(bray_arg_fecal ~ `Study period`, 
        data = relab_arg_fecal_filtered, 
        permutations = 4999)
adonis2(bray_arg_fecal_black ~ `Study period`, 
        data = relab_arg_fecal_filtered_black, 
        permutations = 4999)
adonis2(bray_arg_fecal_white ~ `Study period`, 
        data = relab_arg_fecal_filtered_white, 
        permutations = 4999)
```

arg_oral
```{r permanova_brayo}
adonis2(bray_arg_oral ~ subject_id + `Study period`, 
        data = relab_arg_oral_filtered, 
        permutations = 4999)
adonis2(bray_arg_oral ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use`, data = relab_arg_oral_filtered, permutations = 4999)
adonis2(bray_arg_oral ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_arg_oral_filtered, permutations = 4999)

adonis2(bray_arg_oral ~ Ethnicity, 
        data = relab_arg_oral_filtered, 
        permutations = 4999)
adonis2(bray_arg_oral_before ~ Ethnicity, 
        data = relab_arg_oral_filtered_before, 
        permutations = 4999)
adonis2(bray_arg_oral_after ~ Ethnicity, 
        data = relab_arg_oral_filtered_after, 
        permutations = 4999)

adonis2(bray_arg_oral ~ `Study period`, 
        data = relab_arg_oral_filtered, 
        permutations = 4999)
adonis2(bray_arg_oral_black ~ `Study period`, 
        data = relab_arg_oral_filtered_black, 
        permutations = 4999)
adonis2(bray_arg_oral_white ~ `Study period`, 
        data = relab_arg_oral_filtered_white, 
        permutations = 4999)

```

#### Jaccard
arg_fecal
```{r permanova_jaccf}
adonis2(jacc_arg_fecal ~ subject_id + `Study period` + subject_id*`Study period`, 
        data = relab_arg_fecal_filtered, 
        permutations = 4999)
adonis2(jacc_arg_fecal ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use`, data = relab_arg_fecal_filtered, permutations = 4999)
adonis2(jacc_arg_fecal ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_arg_fecal_filtered, permutations = 4999)

adonis2(jacc_arg_fecal ~ Ethnicity, 
        data = relab_arg_fecal_filtered, 
        permutations = 4999)
adonis2(jacc_arg_fecal_before ~ Ethnicity, 
        data = relab_arg_fecal_filtered_before, 
        permutations = 4999)
adonis2(jacc_arg_fecal_during ~ Ethnicity, 
        data = relab_arg_fecal_filtered_during, 
        permutations = 4999)
adonis2(jacc_arg_fecal_after ~ Ethnicity, 
        data = relab_arg_fecal_filtered_after, 
        permutations = 4999)

adonis2(jacc_arg_fecal ~ `Study period`, 
        data = relab_arg_fecal_filtered, 
        permutations = 4999)
adonis2(jacc_arg_fecal_black ~ `Study period`, 
        data = relab_arg_fecal_filtered_black, 
        permutations = 4999)
adonis2(jacc_arg_fecal_white ~ `Study period`, 
        data = relab_arg_fecal_filtered_white, 
        permutations = 4999)
```

arg_oral
```{r permanova_jacco}
adonis2(jacc_arg_oral ~ subject_id + `Study period`, 
        data = relab_arg_oral_filtered, 
        permutations = 4999)
adonis2(bray_arg_oral ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use`, data = relab_arg_oral_filtered, permutations = 4999)
adonis2(bray_arg_oral ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_arg_oral_filtered, permutations = 4999)

adonis2(jacc_arg_oral ~ Ethnicity, 
        data = relab_arg_oral_filtered, 
        permutations = 4999)
adonis2(jacc_arg_oral_before ~ Ethnicity, 
        data = relab_arg_oral_filtered_before, 
        permutations = 4999)
adonis2(jacc_arg_oral_after ~ Ethnicity, 
        data = relab_arg_oral_filtered_after, 
        permutations = 4999)

adonis2(jacc_arg_oral ~ `Study period`, 
        data = relab_arg_oral_filtered, 
        permutations = 4999)
adonis2(jacc_arg_oral_black ~ `Study period`, 
        data = relab_arg_oral_filtered_black, 
        permutations = 4999)
adonis2(jacc_arg_oral_white ~ `Study period`, 
        data = relab_arg_oral_filtered_white, 
        permutations = 4999)
```

### ARG abundance

Wilcoxon Rank Sum tests (base R) were used to assess if self-reported Ethnicity is associated with the abundance of individual ARG categories. P-values are corrected using fdrtool (v.1.2.16).

```{r arg_models_fecal}
Ethnicity_estimatematrix = mat.or.vec(21,2)
Ethnicity_pvaluematrix = mat.or.vec(21,2)

relab_arg_fecal_filtered = as.data.frame(relab_arg_fecal_filtered)

relab_arg_ethnicity = relab_arg_fecal_filtered %>% 
  group_by(Ethnicity) %>% 
  summarize(across(`ABC Transporter`:`Target Protection`, ~mean(.)))
relab_arg_ethnicity_t = as.data.frame(t(relab_arg_ethnicity))
names(relab_arg_ethnicity_t) <- relab_arg_ethnicity_t[1,]
relab_arg_ethnicity_t = relab_arg_ethnicity_t[-1,]

for(i in 2:22) {
  variable = relab_arg_fecal_filtered[,i]
  b = wilcox.test(variable ~ Ethnicity, 
                  data = relab_arg_fecal_filtered,
                  paired = F, exact = F)
  Ethnicity_estimatematrix[i-1,2] = b$statistic
  Ethnicity_pvaluematrix[i-1,2] = b$p.value
  Ethnicity_estimatematrix[i-1,1] = names(relab_arg_fecal_filtered)[i]
  Ethnicity_pvaluematrix[i-1,1] = names(relab_arg_fecal_filtered)[i]
}


arg_Ethnicity = bind_cols(as.data.frame(Ethnicity_estimatematrix[,1:2]), 
                     as.data.frame(Ethnicity_pvaluematrix[,2]), 
                     as.data.frame(relab_arg_ethnicity_t[,1:2]))
write.csv(arg_Ethnicity, "tables/arg_fecal_wilcox_Ethnicity_y2.csv")
arg_Ethnicity_nona = filter(arg_Ethnicity, arg_Ethnicity[,3] != "NaN") 
arg_Ethnicity_nona[,3] = as.numeric(as.character(arg_Ethnicity_nona[,3]))
arg_Ethnicity_corrected = bind_cols(arg_Ethnicity_nona, 
                               as.data.frame(fdrtool(arg_Ethnicity_nona[,3], 
                                                     statistic = "pvalue", 
                                                     plot = F)))
write.csv(arg_Ethnicity_corrected, "tables/arg_fecal_wilcox_Ethnicity_corrected_y2.csv")
```

```{r arg_models_oral}
Ethnicity_estimatematrix = mat.or.vec(21,2)
Ethnicity_pvaluematrix = mat.or.vec(21,2)

relab_arg_oral_filtered = as.data.frame(relab_arg_oral_filtered)

relab_arg_ethnicity = relab_arg_oral_filtered %>% 
  group_by(Ethnicity) %>% 
  summarize(across(`ABC Transporter`:`Target Protection`, ~mean(.)))
relab_arg_ethnicity_t = as.data.frame(t(relab_arg_ethnicity))
names(relab_arg_ethnicity_t) <- relab_arg_ethnicity_t[1,]
relab_arg_ethnicity_t = relab_arg_ethnicity_t[-1,]

for(i in 2:22) {
  variable = relab_arg_oral_filtered[,i]
  b = wilcox.test(variable ~ Ethnicity, 
                  data = relab_arg_oral_filtered,
                  paired = F, exact = F)
  Ethnicity_estimatematrix[i-1,2] = b$statistic
  Ethnicity_pvaluematrix[i-1,2] = b$p.value
  Ethnicity_estimatematrix[i-1,1] = names(relab_arg_oral_filtered)[i]
  Ethnicity_pvaluematrix[i-1,1] = names(relab_arg_oral_filtered)[i]
}


arg_Ethnicity = bind_cols(as.data.frame(Ethnicity_estimatematrix[,1:2]), 
                     as.data.frame(Ethnicity_pvaluematrix[,2]), 
                     as.data.frame(relab_arg_ethnicity_t[,1:2]))
write.csv(arg_Ethnicity, "tables/arg_oral_wilcox_Ethnicity_y2.csv")
arg_Ethnicity_nona = filter(arg_Ethnicity, arg_Ethnicity[,3] != "NaN") 
arg_Ethnicity_nona[,3] = as.numeric(as.character(arg_Ethnicity_nona[,3]))
arg_Ethnicity_corrected = bind_cols(arg_Ethnicity_nona, 
                               as.data.frame(fdrtool(arg_Ethnicity_nona[,3], 
                                                     statistic = "pvalue", 
                                                     plot = F)))
write.csv(arg_Ethnicity_corrected, "tables/arg_oral_wilcox_Ethnicity_corrected_y2.csv")
```


## CAZymes

### CAZyme abundance

Wilcoxon Rank Sum tests (base R) were used to assess if self-reported Ethnicity is associated with the abundance of individual CAZyme categories. P-values are corrected using fdrtool (v.1.2.16).

```{r import_caz}
relab_cazymes = read_tsv("CAZyme_files/caz_c2_contig.tsv")
  
relab_caz_fecal_filtered = relab_cazymes %>% left_join(metadata2, by = c("sample" = "SampleID")) %>% 
  filter(fecal_use == 1)
relab_caz_oral_filtered = relab_cazymes %>% left_join(metadata2, by = c("sample" = "SampleID")) %>% 
  filter(oral_use == 1)

bray_caz_fecal = vegdist(relab_caz_fecal_filtered[,2:26], method = "bray")
bray_caz_oral = vegdist(relab_caz_oral_filtered[,2:26], method = "bray")
jaccard_caz_fecal = vegdist(relab_caz_fecal_filtered[,2:26], method = "jaccard")
jaccard_caz_oral = vegdist(relab_caz_oral_filtered[,2:26], method = "jaccard")

adonis2(bray_caz_fecal ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_caz_fecal_filtered, permutations = 4999)
adonis2(bray_caz_oral ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_caz_oral_filtered, permutations = 4999)
adonis2(jaccard_caz_fecal ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_caz_fecal_filtered, permutations = 4999)
adonis2(jaccard_caz_oral ~ Ethnicity + `Study period` + `Antibiotic use` + `Contraceptive use` + subject_id, data = relab_caz_oral_filtered, permutations = 4999)
```

```{r caz_models_fecal}
Ethnicity_estimatematrix = mat.or.vec(25,2)
Ethnicity_pvaluematrix = mat.or.vec(25,2)

relab_caz_fecal_filtered = as.data.frame(relab_caz_fecal_filtered)

relab_caz_ethnicity = relab_caz_fecal_filtered %>% 
  group_by(Ethnicity) %>% 
  summarize(across(Arabinogalactan_protein:Xyloglucan, ~mean(.)))
relab_caz_ethnicity_t = as.data.frame(t(relab_caz_ethnicity))
names(relab_caz_ethnicity_t) <- relab_caz_ethnicity_t[1,]
relab_caz_ethnicity_t = relab_caz_ethnicity_t[-1,]

for(i in 2:26) {
  variable = relab_caz_fecal_filtered[,i]
  b = wilcox.test(variable ~ Ethnicity, 
                  data = relab_caz_fecal_filtered,
                  paired = F, exact = F)
  Ethnicity_estimatematrix[i-1,2] = b$statistic
  Ethnicity_pvaluematrix[i-1,2] = b$p.value
  Ethnicity_estimatematrix[i-1,1] = names(relab_caz_fecal_filtered)[i]
  Ethnicity_pvaluematrix[i-1,1] = names(relab_caz_fecal_filtered)[i]
}


caz_Ethnicity = bind_cols(as.data.frame(Ethnicity_estimatematrix[,1:2]), 
                     as.data.frame(Ethnicity_pvaluematrix[,2]), 
                     as.data.frame(relab_caz_ethnicity_t[,1:2]))
write.csv(caz_Ethnicity, "tables/caz_fecal_wilcox_Ethnicity_y2.csv")
caz_Ethnicity_nona = filter(caz_Ethnicity, caz_Ethnicity[,3] != "NaN") 
caz_Ethnicity_nona[,3] = as.numeric(as.character(caz_Ethnicity_nona[,3]))
caz_Ethnicity_corrected = bind_cols(caz_Ethnicity_nona, 
                               as.data.frame(fdrtool(caz_Ethnicity_nona[,3], 
                                                     statistic = "pvalue", 
                                                     plot = F)))
write.csv(caz_Ethnicity_corrected, "tables/caz_fecal_wilcox_Ethnicity_corrected_y2.csv")
```

```{r caz_models_oral}
Ethnicity_estimatematrix = mat.or.vec(25,2)
Ethnicity_pvaluematrix = mat.or.vec(25,2)

relab_caz_oral_filtered = as.data.frame(relab_caz_oral_filtered)

relab_caz_ethnicity = relab_caz_oral_filtered %>% 
  group_by(Ethnicity) %>% 
  summarize(across(Arabinogalactan_protein:Xyloglucan, ~mean(.)))
relab_caz_ethnicity_t = as.data.frame(t(relab_caz_ethnicity))
names(relab_caz_ethnicity_t) <- relab_caz_ethnicity_t[1,]
relab_caz_ethnicity_t = relab_caz_ethnicity_t[-1,]

for(i in 2:26) {
  variable = relab_caz_oral_filtered[,i]
  b = wilcox.test(variable ~ Ethnicity, 
                  data = relab_caz_oral_filtered,
                  paired = F, exact = F)
  Ethnicity_estimatematrix[i-1,2] = b$statistic
  Ethnicity_pvaluematrix[i-1,2] = b$p.value
  Ethnicity_estimatematrix[i-1,1] = names(relab_caz_oral_filtered)[i]
  Ethnicity_pvaluematrix[i-1,1] = names(relab_caz_oral_filtered)[i]
}


caz_Ethnicity = bind_cols(as.data.frame(Ethnicity_estimatematrix[,1:2]), 
                     as.data.frame(Ethnicity_pvaluematrix[,2]), 
                     as.data.frame(relab_caz_ethnicity_t[,1:2]))
write.csv(caz_Ethnicity, "tables/caz_oral_wilcox_Ethnicity_y2.csv")
caz_Ethnicity_nona = filter(caz_Ethnicity, caz_Ethnicity[,3] != "NaN") 
caz_Ethnicity_nona[,3] = as.numeric(as.character(caz_Ethnicity_nona[,3]))
caz_Ethnicity_corrected = bind_cols(caz_Ethnicity_nona, 
                               as.data.frame(fdrtool(caz_Ethnicity_nona[,3], 
                                                     statistic = "pvalue", 
                                                     plot = F)))
write.csv(caz_Ethnicity_corrected, "tables/caz_oral_wilcox_Ethnicity_corrected_y2.csv")
```

Relative abundance graphs for cohort 2


```{r caz_graphs_fecal}
Aplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Lignin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() +
  ggtitle("Lignin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Bplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Cellulose)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Cellulose") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Cplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Xylan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Xylan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Dplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Xyloglucan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Xyloglucans") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Eplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Pectin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Pectin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Fplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Man0n)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Mannan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Gplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Chitin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Chitin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Hplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Peptidoglycan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Peptidoglycan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Iplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, `Mixed Polysaccharides`)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Mixed Polysaccharides") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Jplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Starch)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Starch") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Kplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Dextran)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Dextran") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Lplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Fructan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Fructan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Mplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, `Mixed Oligosaccharides`)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Mixed Oligosaccharides") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Nplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Mucin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Mucin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Oplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Arabinogalactan_protein)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Arabinogalactan proteins") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Pplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, Glycosaminoglycan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Glycosaminoglycan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Qplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, cCellulose)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cCellulose") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Rplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, cXylan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cXylan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Splot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, cXyloglucan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cXyloglucans") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Tplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, cMan0n)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cMannan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Uplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, cChitin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cChitin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Vplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, cPeptidoglycan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cPeptidoglycan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Wplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, cMixed)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cMixed") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Xplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, `c_-glucans`)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cBeta-glucans") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Yplot = ggplot(relab_caz_fecal_filtered, aes(Ethnicity, cStarch)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cStarch") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))

svg(file = "figures/figure_S_cazymes.svg", width = 15,
     height = 15)
plot = plot_grid(Aplot, Bplot, Cplot, Dplot, Eplot,
                 Fplot, Gplot, Hplot, Iplot, Jplot,
                 Kplot, Lplot, Mplot, Nplot, Oplot,
                 Pplot, Qplot, Rplot, Splot, Tplot, 
                 Uplot, Vplot, Wplot, Xplot, Yplot,
                 row = 5, ncol = 5,
          align = "hv", axis = "t")
plot
dev.off()
```

```{r caz_graphs_oral}
Aplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Lignin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() +
  ggtitle("Lignin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Bplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Cellulose)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Cellulose") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Cplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Xylan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Xylan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Dplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Xyloglucan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Xyloglucans") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Eplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Pectin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Pectin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Fplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Man0n)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Mannan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Gplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Chitin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Chitin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Hplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Peptidoglycan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Peptidoglycan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Iplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, `Mixed Polysaccharides`)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Mixed Polysaccharides") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Jplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Starch)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Starch") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Kplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Dextran)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Dextran") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Lplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Fructan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Fructan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Mplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, `Mixed Oligosaccharides`)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Mixed Oligosaccharides") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Nplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Mucin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Mucin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Oplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Arabinogalactan_protein)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Arabinogalactan proteins") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Pplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, Glycosaminoglycan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("Glycosaminoglycan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Qplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, cCellulose)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cCellulose") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Rplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, cXylan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cXylan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Splot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, cXyloglucan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cXyloglucans") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Tplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, cMan0n)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cMannan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Uplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, cChitin)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cChitin") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Vplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, cPeptidoglycan)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cPeptidoglycan") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Wplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, cMixed)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cMixed") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Xplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, `c_-glucans`)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cBeta-glucans") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))


Yplot = ggplot(relab_caz_oral_filtered, aes(Ethnicity, cStarch)) +
  geom_violin(scale = "width", aes(fill = Ethnicity),color=NA, alpha = 0.3,trim=T) +
  geom_jitter(size=1,aes(color = Ethnicity),shape=1) + 
  geom_boxplot(fill='black',width = 0.1, outlier.size = NA, outlier.shape = NA) + 
  stat_summary(fun = "median", size = 2, geom = "point", colour='white', 
               shape=1, stroke = 0.8) + 
  scale_color_manual(values=c("#f5c4ca","#87ceeb")) + 
  scale_fill_manual(values=c("#f5c4ca","#87ceeb")) + 
  theme_classic() + labs(y = "Relative abundance of CAZymes") +
  ggtitle("cStarch") +
  theme_bw() + theme(legend.position="NULL") + 
  theme(axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),
        panel.background = element_rect(colour = "black", size=1)) + 
  theme(axis.text.x=element_text(angle=0,hjust=0.5,vjust=0.5))

svg(file = "figures/figure_S_cazymes_oral.svg", width = 15,
     height = 15)
plot = plot_grid(Aplot, Bplot, Cplot, Dplot, Eplot,
                 Fplot, Gplot, Hplot, Iplot, Jplot,
                 Kplot, Lplot, Mplot, Nplot, Oplot,
                 Pplot, Qplot, Rplot, Splot, Tplot, 
                 Uplot, Vplot, Wplot, Xplot, Yplot,
                 row = 5, ncol = 5,
          align = "hv", axis = "t")
plot
dev.off()
```

## NMDS plots

### Cohort 1 fecal COGs
```{r nmds_y1fcog}
cogfy1 = read_tsv("year1_files/cog_collapsed_categories.txt")
metacogy1 = read_tsv("year1_sample_mapping.tsv") %>% 
  mutate(Ethnicity = case_when(
    Ethnicity == "African_American" ~ "Black", 
    Ethnicity == "Caucasian" ~ "White")) %>% 
  left_join(cogfy1, by = c("file_prefix" = "id")) %>% 
  filter(fecal_use == 1)

bray_fecal_cog_y1 = vegdist(metacogy1[,26:50], method = "bray")


mds_bray_f_cog_y1<-metaMDS(bray_fecal_cog_y1, k=2, trymax=999)
mds_bray_f_cog_y1_points<-mds_bray_f_cog_y1$points
mds_bray_f_cog_y1_points2<-merge(x=mds_bray_f_cog_y1_points, 
                              y = metacogy1, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayfcogy1 <- ggplot(mds_bray_f_cog_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_cog_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 9.3% </b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.025",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfcogy1


brayfcogy1s <- ggplot(mds_bray_f_cog_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_cog_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> = 0.001, 
           r<sup>2</sup> = 1.8%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.025",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfcogy1s
```

### Cohort 2 fecal COGs
```{r nmds_y2fcog}
bray_fecal_cog_y2 = vegdist(relab_cog_fecal_filtered[,2:25], method = "bray")

mds_bray_f_cog_y2<-metaMDS(bray_fecal_cog_y2, k=2, trymax=999)
mds_bray_f_cog_y2_points<-mds_bray_f_cog_y2$points
mds_bray_f_cog_y2_points2<-merge(x=mds_bray_f_cog_y2_points, 
                              y = relab_cog_fecal_filtered, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayfcogy2 <- ggplot(mds_bray_f_cog_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_cog_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> = 0.020, 
           r<sup>2</sup> = 1.2%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.052",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfcogy2

brayfcogy2s <- ggplot(mds_bray_f_cog_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_cog_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> = 0.004, 
           r<sup>2</sup> = 2.4%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.052",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfcogy2s
```

### Cohort 1 oral COGs
```{r nmds_y1ocog}
cogoy1 = read_tsv("year1_files/cog.txt")
metacogoy1 = read_tsv("year1_sample_mapping.tsv") %>% 
  mutate(Ethnicity = case_when(
    Ethnicity == "African_American" ~ "Black", 
    Ethnicity == "Caucasian" ~ "White")) %>% 
  left_join(cogoy1, by = c("file_prefix" = "id")) %>% 
  filter(oral_use == 1)

bray_oral_cog_y1 = vegdist(metacogoy1[,26:146], method = "bray")


mds_bray_o_cog_y1<-metaMDS(bray_oral_cog_y1, k=2, trymax=999)
mds_bray_o_cog_y1_points<-mds_bray_o_cog_y1$points
mds_bray_o_cog_y1_points2<-merge(x=mds_bray_o_cog_y1_points, 
                              y = metacogoy1, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayocogy1 <- ggplot(mds_bray_o_cog_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_cog_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 9.4% </b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.015",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayocogy1

brayocogy1s <- ggplot(mds_bray_o_cog_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_cog_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.759, 
           r<sup>2</sup> = 0.1%", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.015",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayocogy1s
```

### Cohort 2 oral COGs
```{r nmds_y2ocog}
bray_oral_cog_y2 = vegdist(relab_cog_oral_filtered[,2:25], method = "bray")

mds_bray_o_cog_y2<-metaMDS(bray_oral_cog_y2, k=2, trymax=999)
mds_bray_o_cog_y2_points<-mds_bray_o_cog_y2$points
mds_bray_o_cog_y2_points2<-merge(x=mds_bray_o_cog_y2_points, 
                              y = relab_cog_oral_filtered, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayocogy2 <- ggplot(mds_bray_o_cog_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_cog_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> = 0.003, 
           r<sup>2</sup> = 3.5%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.007",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayocogy2

brayocogy2s <- ggplot(mds_bray_o_cog_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_cog_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> = 0.027, 
           r<sup>2</sup> = 1.9%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.007",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayocogy2s
```

### Cohort 1 virome COGs
```{r nmds_y1fvcog}
vir_cog = read_tsv("Virome_files_y1/virome_cog.txt")

bray_fecalvcog_y1 = vegdist(vir_cog[,7:29], method = "bray")

y1cogfv = vir_cog %>% 
  mutate(Ethnicity = case_when(
    Ethnicity == "African_American" ~ "Black", 
    Ethnicity == "Caucasian" ~ "White"))

mds_bray_fvcog_y1<-metaMDS(bray_fecalvcog_y1, k=2, trymax=999)
mds_bray_fvcog_y1_points<-mds_bray_fvcog_y1$points
mds_bray_fvcog_y1_points2<-merge(x=mds_bray_fvcog_y1_points, 
                              y = y1cogfv, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayfvcogy1 <- ggplot(mds_bray_fvcog_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_fvcog_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 7.2% </b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.180",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfvcogy1

brayfvcogy1s <- ggplot(mds_bray_fvcog_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Stage)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_fvcog_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Stage), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.052, 
           r<sup>2</sup> = 1.6% </b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.180",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfvcogy1s
```

### Cohort 1 fecal ARGs
```{r nmds_y1farg}
argfy1 = read_tsv("year1_files/args_noout.txt")
metaargy1 = read_tsv("year1_sample_mapping.tsv") %>% 
  mutate(Ethnicity = case_when(
    Ethnicity == "African_American" ~ "Black", 
    Ethnicity == "Caucasian" ~ "White")) %>% 
  right_join(argfy1, by = c("file_prefix" = "sample")) %>% 
  filter(fecal_use == 1)

bray_fecal_arg_y1 = vegdist(metaargy1[,34:55], method = "bray")

mds_bray_f_arg_y1<-metaMDS(bray_fecal_arg_y1, k=2, trymax=999)
mds_bray_f_arg_y1_points<-mds_bray_f_arg_y1$points
mds_bray_f_arg_y1_points2<-merge(x=mds_bray_f_arg_y1_points, 
                              y = metaargy1, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayfargy1 <- ggplot(mds_bray_f_arg_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity.x)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_arg_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity.x), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 7.5% </b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.051",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfargy1

brayfargy1s <- ggplot(mds_bray_f_arg_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_arg_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> = 0.002, 
           r<sup>2</sup> = 2.1%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.051",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfargy1s
```
### Cohort 2 fecal ARGs
```{r nmds_y2farg}
bray_fecal_arg_y2 = vegdist(relab_arg_fecal_filtered[,2:22], method = "bray")

adonis2(bray_fecal_arg_y2 ~ Ethnicity, data = relab_arg_fecal_filtered, permutations = 4999)

mds_bray_f_arg_y2<-metaMDS(bray_fecal_arg_y2, k=2, trymax=999)
mds_bray_f_arg_y2_points<-mds_bray_f_arg_y2$points
mds_bray_f_arg_y2_points2<-merge(x=mds_bray_f_arg_y2_points, 
                              y = relab_arg_fecal_filtered, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayfargy2 <- ggplot(mds_bray_f_arg_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_arg_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.078, 
           r<sup>2</sup> = 0.6%", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.060",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfargy2

brayfargy2s <- ggplot(mds_bray_f_arg_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_arg_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> = 0.005, 
           r<sup>2</sup> = 1.8%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.060",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfargy2s
```

### Cohort 1 oral ARGs
```{r nmds_y1oarg}
argoy1 = read_tsv("year1_files/args_noout.txt")
metaargoy1 = read_tsv("year1_sample_mapping.tsv") %>% 
  mutate(Ethnicity = case_when(
    Ethnicity == "African_American" ~ "Black", 
    Ethnicity == "Caucasian" ~ "White")) %>% 
  right_join(argoy1, by = c("file_prefix" = "sample")) %>% 
  filter(oral_use == 1)

bray_oral_arg_y1 = vegdist(metaargoy1[,34:55], method = "bray")

mds_bray_o_arg_y1<-metaMDS(bray_oral_arg_y1, k=2, trymax=999)
mds_bray_o_arg_y1_points<-mds_bray_o_arg_y1$points
mds_bray_o_arg_y1_points2<-merge(x=mds_bray_o_arg_y1_points, 
                              y = metaargoy1, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayoargy1 <- ggplot(mds_bray_o_arg_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity.x)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_arg_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity.x), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 13.2% </b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.026",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayoargy1

brayoargy1s <- ggplot(mds_bray_o_arg_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_arg_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.796, 
           r<sup>2</sup> = 0.01%", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.026",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayoargy1s
```
### Cohort 2 oral ARGs
```{r nmds_y2oarg}
bray_oral_arg_y2 = vegdist(relab_arg_oral_filtered[,2:22], method = "bray")

adonis2(bray_oral_arg_y2 ~ Ethnicity, data = relab_arg_oral_filtered, permutations = 4999)

mds_bray_o_arg_y2<-metaMDS(bray_oral_arg_y2, k=2, trymax=999)
mds_bray_o_arg_y2_points<-mds_bray_o_arg_y2$points
mds_bray_o_arg_y2_points2<-merge(x=mds_bray_o_arg_y2_points, 
                              y = relab_arg_oral_filtered, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayoargy2 <- ggplot(mds_bray_o_arg_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_arg_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> = 0.010, 
           r<sup>2</sup> = 2.5%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.025",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayoargy2

brayoargy2s <- ggplot(mds_bray_o_arg_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_arg_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> = 0.028, 
           r<sup>2</sup> = 1.9%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.025",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayoargy2s
```
### Cohort 1 virome ARGs
```{r nmds_y1fvarg}
vir_arg = read_tsv("Virome_files_y1/virome_arg_y1.txt")

bray_fecalvarg_y1 = vegdist(vir_arg[,7:22], method = "bray")

y1argfv = vir_arg %>% 
  mutate(Ethnicity = case_when(
    Ethnicity == "African_American" ~ "Black", 
    Ethnicity == "Caucasian" ~ "White"))

mds_bray_fvarg_y1<-metaMDS(bray_fecalvarg_y1, k=2, trymax=999)
mds_bray_fvarg_y1_points<-mds_bray_fvarg_y1$points
mds_bray_fvarg_y1_points2<-merge(x=mds_bray_fvarg_y1_points, 
                              y = y1argfv, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayfvargy1 <- ggplot(mds_bray_fvarg_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_fvarg_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 6.2%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.190",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfvargy1

brayfvargy1s <- ggplot(mds_bray_fvarg_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Stage)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_fvarg_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Stage), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.810, 
           r<sup>2</sup> = 0.7%", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.190",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfvargy1s
```

### Cohort 1 fecal CAZymes
```{r nmds_y1fcaz}
cazfy1 = read_tsv("year1_files/cazyme_noout.txt")
metafcazy1 = read_tsv("year1_sample_mapping.tsv") %>% 
  mutate(Ethnicity = case_when(
    Ethnicity == "African_American" ~ "Black", 
    Ethnicity == "Caucasian" ~ "White")) %>% 
  right_join(cazfy1, by = c("file_prefix" = "sample")) %>% 
  filter(fecal_use == 1)

bray_fecal_caz_y1 = vegdist(metafcazy1[,34:58], method = "bray")

mds_bray_f_caz_y1<-metaMDS(bray_fecal_caz_y1, k=2, trymax=999)
mds_bray_f_caz_y1_points<-mds_bray_f_caz_y1$points
mds_bray_f_caz_y1_points2<-merge(x=mds_bray_f_caz_y1_points, 
                              y = metafcazy1, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayfcazy1 <- ggplot(mds_bray_f_caz_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity.x)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_caz_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity.x), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 1.9%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.040",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfcazy1

brayfcazy1s <- ggplot(mds_bray_f_caz_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_caz_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.174, 
           r<sup>2</sup> = 0.5%", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.040",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfcazy1s
```

### Cohort 2 fecal CAZymes
```{r nmds_y2fcaz}
relab_caz_fecal_filtered =  read_tsv("CAZyme_files/caz_c2_contig.tsv") %>%
  left_join(metadata2, by = c("sample" = "SampleID")) %>% 
  filter(fecal_use == 1)

bray_fecal_caz_y2 = vegdist(relab_caz_fecal_filtered[,2:26], method = "bray")

adonis2(bray_fecal_caz_y2 ~ Ethnicity, data = relab_caz_fecal_filtered, permutations = 4999)

mds_bray_f_caz_y2<-metaMDS(bray_fecal_caz_y2, k=2, trymax=999)
mds_bray_f_caz_y2_points<-mds_bray_f_caz_y2$points
mds_bray_f_caz_y2_points2<-merge(x=mds_bray_f_caz_y2_points, 
                              y = relab_caz_fecal_filtered, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayfcazy2 <- ggplot(mds_bray_f_caz_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_caz_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 1.7%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.049",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfcazy2

brayfcazy2s <- ggplot(mds_bray_f_caz_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_f_caz_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.559, 
           r<sup>2</sup> = 0.2%", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.049",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfcazy2s
```
### Cohort 1 oral CAZymes
```{r nmds_y1ocaz}
cazoy1 = read_tsv("year1_files/cazyme_noout.txt")
metaocazy1 = read_tsv("year1_sample_mapping.tsv") %>% 
  mutate(Ethnicity = case_when(
    Ethnicity == "African_American" ~ "Black", 
    Ethnicity == "Caucasian" ~ "White")) %>% 
  right_join(cazoy1, by = c("file_prefix" = "sample")) %>% 
  filter(oral_use == 1)

bray_oral_caz_y1 = vegdist(metaocazy1[,34:58], method = "bray")

mds_bray_o_caz_y1<-metaMDS(bray_oral_caz_y1, k=2, trymax=999)
mds_bray_o_caz_y1_points<-mds_bray_o_caz_y1$points
mds_bray_o_caz_y1_points2<-merge(x=mds_bray_o_caz_y1_points, 
                              y = metaocazy1, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayocazy1 <- ggplot(mds_bray_o_caz_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity.x)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_caz_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity.x), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 33.0%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.026",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayocazy1

brayocazy1s <- ggplot(mds_bray_o_caz_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_caz_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.365, 
           r<sup>2</sup> = 0.3%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.026",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayocazy1s
```

### Cohort 2 oral CAZymes

```{r nmds_y2ocaz}
relab_caz_oral_filtered =  read_tsv("CAZyme_files/caz_c2_contig.tsv") %>%
  left_join(metadata2, by = c("sample" = "SampleID")) %>% 
  filter(oral_use == 1)

bray_oral_caz_y2 = vegdist(relab_caz_oral_filtered[,2:26], method = "bray")

adonis2(bray_oral_caz_y2 ~ Ethnicity, data = relab_caz_oral_filtered, permutations = 4999)

mds_bray_o_caz_y2<-metaMDS(bray_oral_caz_y2, k=2, trymax=999)
mds_bray_o_caz_y2_points<-mds_bray_o_caz_y2$points
mds_bray_o_caz_y2_points2<-merge(x=mds_bray_o_caz_y2_points, 
                              y = relab_caz_oral_filtered, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayocazy2 <- ggplot(mds_bray_o_caz_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_caz_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 9.9%</b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.072",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayocazy2

brayocazy2s <- ggplot(mds_bray_o_caz_y2_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = `Study period`)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_o_caz_y2_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = `Study period`), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.120, 
           r<sup>2</sup> = 1.6%", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.072",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayocazy2s
```

### Cohort 1 virome CAZymes
```{r nmds_y1fvcaz}
vir_caz = read_tsv("Virome_files_y1/virome_peptido.txt")

bray_fecalvcaz_y1 = vegdist(vir_caz[,7:14], method = "bray")

y1cazfv = vir_caz %>% 
  mutate(Ethnicity = case_when(
    Ethnicity == "African_American" ~ "Black", 
    Ethnicity == "Caucasian" ~ "White"))

mds_bray_fvcaz_y1<-metaMDS(bray_fecalvcaz_y1, k=2, trymax=999)
mds_bray_fvcaz_y1_points<-mds_bray_fvcaz_y1$points
mds_bray_fvcaz_y1_points2<-merge(x=mds_bray_fvcaz_y1_points, 
                              y = y1cazfv, 
                              by.x = "row.names", 
                              by.y = "row.names")

brayfvcazy1 <- ggplot(mds_bray_fvcaz_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Ethnicity)) +
  geom_point(size=3) + scale_color_manual(
    values = c("White"="#87ceeb","Black"="#f5c4ca")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_fvcaz_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Ethnicity), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<b><i>p</i> < 0.001, 
           r<sup>2</sup> = 4.1% </b>", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.170",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfvcazy1

brayfvcazy1s <- ggplot(mds_bray_fvcaz_y1_points2, 
                  aes(x = MDS1, y = MDS2, 
                      color = Stage)) +
  geom_point(size=3) + scale_color_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) + scale_fill_manual(
    values = c("Before"="#238b45","During" = "#d94801", "After"="#2171b5")) +
  theme(panel.background = element_rect(fill = 'white', colour = 'black'), 
        legend.key=element_blank()) + 
  theme(axis.title.x=element_blank(), 
        axis.title.y=element_blank(),
        plot.title = element_blank(),
        legend.position = "none") +
  stat_ellipse(data = mds_bray_fvcaz_y1_points2, 
               aes(x = MDS1, y = MDS2, 
                   fill = Stage), 
                   alpha = 0.2, size = 0.8, geom = "polygon",
               linetype = 2,
               type = "t", level = 0.95) +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "<i>p</i> = 0.162, 
           r<sup>2</sup> = 1.6%", 
           x = Inf, y = Inf, size = 5,
           hjust = 1, vjust = 1.1)  +
  annotate(geom = "richtext", fill = NA, label.color = NA,
           label = "Stress = 0.170",
           x = Inf, y = -Inf, size = 4,
           hjust = 1, vjust = 0)
brayfvcazy1s
```

### Combining NMDS plots - Ethnicity
```{r figure3}
svg(file = "figures/figure3.svg", width = 16,
     height = 20)
col1 = plot_grid(brayfy1, brayoy1, brayfvy1,  
                   brayfy2, brayoy2,
                 nrow = 5, ncol = 1, 
                 labels = c("A", "E", "I", "M", "Q"), 
                 label_size = 20)
col2 = plot_grid(brayfcogy1, brayocogy1, brayfvcogy1, 
                   brayfcogy2, brayocogy2,
                 nrow = 5, ncol = 1, 
                 labels = c("B", "F", "J", "N", "R"), 
                 label_size = 20)
col3 = plot_grid(brayfargy1, brayoargy1, brayfvargy1,
                   brayfargy2, brayoargy2,
                 nrow = 5, ncol = 1, 
                 labels = c("C", "G", "K", "O", "S"), 
                 label_size = 20)
col4 = plot_grid(brayfcazy1, brayocazy2, brayfvcazy1,
                   brayfcazy2, brayocazy2,
                 nrow = 5, ncol = 1, 
                 labels = c("D", "H", "L", "P", "T"), 
                 label_size = 20)
plot = plot_grid(col1, col2, col3, col4, nrow = 1, ncol = 4, 
          rel_widths = c(1, 1, 1, 1), 
          align = "h", axis = "t")
plot
dev.off()
```


### Combining NMDS plots - Ethnicity + Stage

```{r figure_s3}
svg(file = "figures/figure_S3.svg", width = 16,
     height = 12)
plot = plot_grid(jaccfy1, jaccfy1s, jaccfy2, jaccfy2s,
                 jaccoy1, jaccoy1s, jaccoy2, jaccoy2s,
                 jaccfvy1, jaccfvy1s,
                 braynrow = 6, ncol = 4,
          align = "hv", axis = "t",
          labels = c("A", "B", "C", "D", "E", "F", "G", "H",
                     "I", "J"))
plot
dev.off()
```



```{r figure_s4}
svg(file = "figure_S4.svg", width = 16, height = 20)
plot = plot_grid(brayfy1s, brayfcogy1s, brayfargy1s, 
                 brayfcazy1s, brayoy1s, brayocogy1s,
                 brayoargy1s, brayocazy1s, brayfvy1s,
                 brayfvcogy1s, brayfvargy1s, brayfvcazy1s,
                 brayfy2s, brayfcogy2s, brayfargy2s, 
                 brayfcazy2s, brayoy2s, brayocogy2s, 
                 brayoargy2s, brayocazy2s,
                 nrow = 5, ncol = 4,
          align = "hv", axis = "t",
          labels = c("A", "B", "C", "D", "E", "F", "G", "H",
                     "I", "J", "K", "L", "M", "N", "O", "P",
                     "Q", "R", "S", "T"))
plot
dev.off()
```